#:kivy 2.3.0
#:import Factory kivy.factory.Factory

<Screen>:
    canvas.before:
        Color:
            rgba: 0.15, 0.1, 0.25, 1
        Rectangle:
            pos: self.pos
            size: self.size

<RoundedInput@TextInput>:
    font_size: 16 * app.app_settings.font_scale
    multiline: False
    background_normal: ''
    background_active: ''
    background_color: 0, 0, 0, 0
    cursor_color: 1, 1, 1, 1
    foreground_color: 1, 1, 1, 1
    hint_text_color: 0.8, 0.8, 0.8, 1
    padding: [15, (self.height - self.line_height) / 2]
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0.3
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]
        Color:
            rgba: 1, 1, 1, 0.3
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, 20)
            width: 1

<StatBox>:
    orientation: 'vertical'
    size_hint_y: None
    height: 80
    padding: 10
    canvas.before:
        Color:
            rgba: 1, 1, 1, 0.2
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]
    
    Label:
        text: root.value
        font_size: 20 * app.app_settings.font_scale
        bold: True
        color: 1, 1, 1, 1
        size_hint_y: 0.6
    
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.4
        spacing: 5
        Widget:
            size_hint_x: 0.1
        Image:
            source: root.icon_source
            size_hint_x: None
            width: 24
            allow_stretch: True
        Label:
            text: root.title
            font_size: 16 * app.app_settings.font_scale
            color: 0.9, 0.9, 1, 0.8
            halign: 'left'
            size_hint_x: 0.8
            text_size: self.size

<WelcomeScreen>:
    FloatLayout:
        Label:
            text: "Aplikacja pogodowa"
            font_size: 48 * app.app_settings.font_scale
            bold: True
            pos_hint: {'center_x': 0.5, 'center_y': 0.65}
            color: 1, 1, 1, 1
            outline_width: 2
            outline_color: 0, 0, 0, 0.5
        
        Button:
            text: "Kontynuuj"
            size_hint: 0.6, 0.08
            pos_hint: {'center_x': 0.5, 'center_y': 0.2}
            background_normal: ''
            background_color: 0, 0, 0, 0
            color: 1, 1, 1, 1
            bold: True
            font_size: 18 * app.app_settings.font_scale
            on_release: root.manager.current = 'weather'
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 0.2
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [25,]
                Color:
                    rgba: 1, 1, 1, 0.4
                Line:
                    rounded_rectangle: (self.x, self.y, self.width, self.height, 25)
                    width: 1

<DayCard>:
    orientation: 'vertical'
    size_hint: None, None
    width: 110
    height: 150
    padding: 10
    spacing: 5
    canvas.before:
        Color:
            rgba: 0.4, 0.35, 0.8, 0.85
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]
            texture: Factory.Gradient().vertical_gradient((0.5, 0.4, 0.9, 1), (0.3, 0.2, 0.7, 1))

    Image:
        source: root.icon_source
        size_hint_y: 0.5
        allow_stretch: True

    Label:
        text: root.temp
        font_size: 24 * app.app_settings.font_scale
        bold: True
        size_hint_y: 0.3
    
    Label:
        text: root.day_name
        font_size: 13 * app.app_settings.font_scale
        color: 0.9, 0.9, 1, 1
        size_hint_y: 0.2

<SettingsPopup>:
    title: "Ustawienia"
    size_hint: 0.8, 0.4
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 20
        Label:
            text: "Jasność ekranu"
            color: 1,1,1,1
            size_hint_y: None
            height: 30
        
        Slider:
            min: 0.1
            max: 1.0
            value: root.app_ref.app_settings.brightness
            on_value: root.app_ref.app_settings.brightness = self.value
            
        Button:
            text: "Zamknij"
            size_hint_y: None
            height: 40
            on_release: root.dismiss()

<WeatherScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 20

        BoxLayout:
            size_hint_y: None
            height: 50
            Label:
                text: "Strona Główna"
                bold: True
                color: 1, 1, 1, 1
                font_size: 20 * app.app_settings.font_scale
                halign: 'left'
                text_size: self.size
                outline_width: 1
                outline_color: 0,0,0,0.5
            
            Button:
                text: "Opcje"
                size_hint_x: None
                width: 70
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: 1, 1, 1, 1
                font_size: 14
                on_release: root.show_settings()
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 0.2
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [10,]
                    Color:
                        rgba: 1, 1, 1, 0.3
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 10)
                        width: 1

        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.45
            padding: 20
            spacing: 5
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 0.9
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [30,]
                    texture: Factory.Gradient().vertical_gradient((0.4, 0.2, 0.8, 1), (0.2, 0.5, 0.9, 1))
            
            Image:
                source: root.current_icon_src
                size_hint_y: 0.35
                allow_stretch: True
                keep_ratio: True

            Label:
                text: root.current_temp
                font_size: 80 * app.app_settings.font_scale
                bold: True
                size_hint_y: 0.35
                halign: 'center'
                valign: 'middle'
                text_size: self.size

            Label:
                text: root.current_day
                font_size: 24 * app.app_settings.font_scale
                size_hint_y: None
                height: 40
                bold: True
                halign: 'center'
                valign: 'middle'
                text_size: self.size 
                color: 0.9, 0.9, 1, 1

            Label:
                text: root.current_city
                font_size: 18 * app.app_settings.font_scale
                size_hint_y: None
                height: 30
                halign: 'center'
                valign: 'top'
                text_size: self.size
                color: 0.8, 0.8, 1, 0.8

        BoxLayout:
            size_hint_y: None
            height: 60
            padding: [0, 10]
            spacing: 10
            
            RoundedInput:
                id: search_input
                hint_text: "Szukaj miasta..."
                text: ""
                on_text_validate: root.determine_search_method()
            
            Button:
                text: ">"
                size_hint_x: None
                width: 50
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: 1, 1, 1, 1
                font_size: 24
                bold: True
                on_release: root.determine_search_method()
                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.3
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [15,]
                    Color:
                        rgba: 1, 1, 1, 0.3
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 15)
                        width: 1

        Label:
            text: "Prognoza na tydzień- by dowiedzieć się więcej kliknij na wybrany przez Ciebie dzień."
            color: 1, 1, 1, 1
            bold: True
            size_hint_y: None
            height: 30
            halign: 'center'
            text_size: self.size
            outline_width: 1
            outline_color: 0,0,0,0.5

        ScrollView:
            size_hint_y: 0.3
            do_scroll_x: True
            do_scroll_y: False
            bar_width: 0
            
            AnchorLayout:
                size_hint_x: None
                width: max(self.parent.width, forecast_grid.minimum_width)
                anchor_x: 'center'
                
                GridLayout:
                    id: forecast_grid
                    rows: 1
                    size_hint_x: None
                    width: self.minimum_width
                    spacing: 15
                    padding: [5, 5]

<DetailsScreen>:
    BoxLayout:
        orientation: 'vertical'
        
        BoxLayout:
            size_hint_y: None
            height: 60
            padding: 10
            Button:
                text: "< Wróć"
                size_hint_x: None
                width: 80
                background_color: 0,0,0,0
                font_size: 18
                bold: True
                color: 1,1,1,1
                on_release: root.go_back()
            Label:
                text: root.day_title
                bold: True
                font_size: 20 * app.app_settings.font_scale
                outline_width: 1
                outline_color: 0,0,0,0.5

        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.35
            padding: [40, 10]
            spacing: 15
            
            BoxLayout:
                spacing: 20
                StatBox:
                    title: "Śr. Temperatura"
                    value: root.avg_temp
                    icon_source: "thermometer.png"
                    on_release: root.show_chart('temp')
                StatBox:
                    title: "Wiatr"
                    value: root.avg_wind
                    icon_source: "wind.png"
                    on_release: root.show_chart('wind')
            
            AnchorLayout:
                anchor_x: 'center'
                StatBox:
                    size_hint_x: 0.5
                    title: "Opady"
                    value: root.rain_sum
                    icon_source: "rainy.png"
                    on_release: root.show_chart('rain')

        BoxLayout:
            orientation: 'vertical'
            padding: 20
            
            Label:
                text: "Wykres (Przesuń palcem)"
                size_hint_y: None
                height: 30
                halign: 'left'
                text_size: self.size
                bold: True
                color: 1, 1, 1, 0.9
                outline_width: 1
                outline_color: 0,0,0,0.5

            InteractiveChart:
                id: chart_widget
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 0.15
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20,]
